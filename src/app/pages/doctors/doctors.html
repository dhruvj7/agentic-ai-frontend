<div class="doctors-page">
  <div class="doctors-header">
    <a class="back" routerLink="/chat">‚Üê Back to Chat</a>
    <h1>Matched doctors</h1>
    <p>Choose a doctor and book an appointment.</p>
  </div>
  <div class="doctors-grid">
    @for (doctor of doctors(); track doctor.id) {
      <article class="doctor-card">
        <div class="card-body">
          <div class="avatar">{{ getInitials(doctor.name) }}</div>
          <h3>{{ doctor.name }}</h3>
          <p class="specialty">{{ doctor.specialty }}</p>
          <p class="qualification">{{ doctor.qualification }}</p>
          <p class="experience">{{ doctor.experience }} experience</p>
          <div class="rating">‚òÖ {{ doctor.rating }}</div>
       
        
@if (doctor.slots && doctor.slots.length) {
  <div class="slots">
    <div class="slots-header">
      <span>Available Appointments</span>
      <span class="slot-count">
        {{ doctor.slots.length }} slots
      </span>
    </div>

    @for (group of groupSlotsByDate(doctor.slots); track group.date) {
      <div class="date-group">
        <div class="date-label">
          {{ group.date }}
        </div>

        <div class="time-grid">
          @for (slot of group.slots; track slot.id) {
            <button
              type="button"
              class="time-pill"
              [class.selected]="selectedSlotId() === +slot.id"
              (click)="selectSlot(+doctor.id, +slot.id)"
            >
              {{ slot.slot_time }}
            </button>
          }
        </div>
      </div>
    }
  </div>
}



        </div>
        <!-- <a [routerLink]="['/book-appointment', doctor.id]" class="btn-book">Book appointment</a> -->

        <div class="card-footer">
  <button 
    type="button" 
    class="btn-book" 
    [disabled]="selectedDoctorId() !== doctor.id || !selectedSlotId()"
    (click)="bookAppointment(+doctor.id)">
    Book appointment
  </button>
</div>
      </article>
    }
  </div>
  @if (doctors().length === 0) {
    <p class="empty">No matched doctors yet. Use the chat to describe your symptoms and we‚Äôll suggest doctors.</p>
    <a routerLink="/chat" class="link-chat">Go to chat</a>
  }
</div>

<!-- Smart automation: slot confirmation modal -->
@if (showSlotConfirmModal() && automation.pendingSlotConfirmation(); as pending) {
  <div class="slot-confirm-overlay" (click)="cancelAutoSlot()">
    <div class="slot-confirm-modal" (click)="$event.stopPropagation()">
      <div class="slot-confirm-header">
        <span class="slot-confirm-icon">üìÖ</span>
        <h3>Confirm your appointment</h3>
        <p class="slot-confirm-sub">
          Book with <strong>{{ pending.doctor?.name }}</strong> on
          <strong>{{ formatSlotLabel(pending.slot!) }}</strong>?
        </p>
      </div>
      <div class="slot-confirm-actions">
        <button type="button" class="btn-confirm-slot" (click)="confirmAutoSlot()">
          Yes, Book
        </button>
        <button type="button" class="btn-cancel-slot" (click)="cancelAutoSlot()">
          Choose different slot
        </button>
      </div>
    </div>
  </div>
}
