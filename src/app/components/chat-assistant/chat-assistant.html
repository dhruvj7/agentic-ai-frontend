<section class="chat-container">
  <div class="chat-header">
    <span class="chat-avatar">‚óá</span>
    <div class="chat-agent-info">
      <h3>{{ assistantName }}</h3>
      <p>Describe your symptoms or ask anything‚ÄîI'll guide you to the right next steps.</p>
    </div>
  </div>

  <div class="messages" #messagesContainer>
    @for (msg of messages(); track $index) {
      <div
        class="message"
        [class.user]="msg.role === 'user'"
        [class.assistant]="msg.role === 'assistant'"
        [class.animate-msg]="true"
      >
        <!-- USER MESSAGE -->
        @if (msg.role === 'user') {
          <p class="message-content">{{ msg.content.text }}</p>
        }

        <!-- ASSISTANT MESSAGE -->
        @else {
          <span class="message-label">{{ assistantName }}</span>

          <!-- MULTI-INTENT RESPONSE -->
          @if (msg.content.type === 'multi_intent') {
            <div class="multi-intent-response">
              <p class="message-intro">{{ msg.content.text }}</p>

              @for (subResult of msg.content.subResults; track $index) {
                <div class="sub-result" [attr.data-intent]="subResult.intent">
                  <!-- SYMPTOM ANALYSIS SECTION -->
                  @if (subResult.intent === 'symptom_analysis') {
                    <div class="symptom-analysis">
                      <p class="sub-message">{{ subResult.message }}</p>

                      @if (subResult.analysis) {
                        <div class="analysis-card">
                          <div
                            class="severity-badge"
                            [attr.data-severity]="subResult.analysis.severity"
                          >
                            {{ getSeverityLabel(subResult.analysis.severity) }}
                          </div>

                          <div class="analysis-section">
                            <h4>üìã Analysis</h4>
                            <p>{{ subResult.analysis.primary_analysis }}</p>

                            @if (subResult.analysis.differential_diagnosis?.length) {
                              <div class="diagnosis-list">
                                <strong>Possible conditions:</strong>
                                <ul>
                                  @for (
                                    diagnosis of subResult.analysis.differential_diagnosis;
                                    track diagnosis
                                  ) {
                                    <li>{{ diagnosis }}</li>
                                  }
                                </ul>
                              </div>
                            }
                          </div>

                          @if (subResult.analysis.red_flags?.length) {
                            <div class="red-flags">
                              <h4>‚ö†Ô∏è Important Warnings</h4>
                              <ul>
                                @for (flag of subResult.analysis.red_flags; track flag) {
                                  <li>{{ flag }}</li>
                                }
                              </ul>
                            </div>
                          }
                        </div>
                      }

                      @if (subResult.recommendations) {
                        <div class="recommendations">
                          @if (subResult.recommendations.immediate_actions?.length) {
                            <div class="rec-section">
                              <h4>üéØ Immediate Actions</h4>
                              <ul>
                                @for (
                                  action of subResult.recommendations.immediate_actions;
                                  track action
                                ) {
                                  <li [innerHTML]="action"></li>
                                }
                              </ul>
                            </div>
                          }

                          @if (subResult.recommendations.home_care_advice?.length) {
                            <div class="rec-section">
                              <h4>üè† Home Care</h4>
                              <ul>
                                @for (
                                  advice of subResult.recommendations.home_care_advice;
                                  track advice
                                ) {
                                  <li>{{ advice }}</li>
                                }
                              </ul>
                            </div>
                          }

                          @if (subResult.recommendations.when_to_seek_help?.length) {
                            <div class="rec-section emergency">
                              <h4>üö® When to Seek Immediate Help</h4>
                              <ul>
                                @for (
                                  help of subResult.recommendations.when_to_seek_help;
                                  track help
                                ) {
                                  <li>{{ help }}</li>
                                }
                              </ul>
                            </div>
                          }
                        </div>
                      }

                      @if (subResult.careOptions?.matched_doctors) {
                        <div class="matched-doctors">
                          <h4>üë®‚Äç‚öïÔ∏è Recommended Doctors</h4>
                          <div class="doctor-grid">
                            @for (
                              doctor of subResult.careOptions?.matched_doctors?.slice(0, 3);
                              track doctor.id
                            ) {
                              <div class="doctor-card" (click)="selectDoctor(doctor)">
                                @if (doctor.imageUrl) {
                                  <img
                                    [src]="doctor.imageUrl"
                                    [alt]="doctor.name"
                                    class="doctor-image"
                                  />
                                } @else {
                                  <div class="doctor-avatar">{{ doctor.name.charAt(0) }}</div>
                                }
                                <div class="doctor-info">
                                  <strong>{{ doctor.name }}</strong>
                                  <span>{{ doctor.specialty }}</span>
                                  @if (doctor.department) {
                                    <span class="dept">{{ doctor.department }}</span>
                                  }
                                  @if (doctor.rating) {
                                    <span class="rating">‚≠ê {{ doctor.rating.toFixed(1) }}</span>
                                  }
                                  @if (doctor.experience) {
                                    <span class="experience">{{ doctor.experience }}</span>
                                  }
                                </div>
                              </div>
                            }
                          </div>
                          @if ((subResult.careOptions?.matched_doctors?.length ?? 0) > 3) {
                            <button class="view-all-btn" (click)="viewMatchedDoctors()">
                              View all {{ subResult.careOptions?.matched_doctors?.length }} doctors
                            </button>
                          }
                        </div>
                      }
                    </div>
                  }

                  <!-- APPOINTMENT BOOKING SECTION -->
                  @if (subResult.intent === 'appointment_booking') {
                    <div class="appointment-booking">
                      <p class="sub-message">{{ subResult.message }}</p>

                      @if (subResult.bookingFlow) {
                        <div class="booking-card">
                          <h4>üìÖ Booking Information</h4>

                          @if (subResult.bookingFlow.next_questions?.length) {
                            <div class="next-questions">
                              <p><strong>Please provide:</strong></p>
                              <ul>
                                @for (
                                  question of subResult.bookingFlow.next_questions;
                                  track question
                                ) {
                                  <li>{{ question }}</li>
                                }
                              </ul>
                            </div>
                          }

                          @if (subResult.instructions) {
                            <div class="booking-steps">
                              <p><strong>Booking Steps:</strong></p>
                              <!-- <ul> -->
                              @for (instruction of subResult.instructions; track instruction) {
                                <div>
                                  {{ instruction }}
                                </div>
                              }
                              <!-- </ul> -->
                            </div>
                          }

                          <button class="cta-book" (click)="viewMatchedDoctors()">
                            üìÖ Book Appointment Now
                          </button>
                        </div>
                      }
                    </div>
                  }

                  @if (subResult.nextSteps) {
                    <div class="next-steps">
                      <h4>‚ú® Next Steps</h4>
                      <ul>
                        @for (step of subResult.nextSteps; track step) {
                          <li>{{ step }}</li>
                        }
                      </ul>
                    </div>
                  }

                  @if (subResult.requiresInsuranceValidation) {
                    <div class="insurance-cta">
                      <button class="cta-insurance" (click)="goToInsurance(subResult.insuranceLink ?? msg.content.insuranceLink)">
                        <span class="cta-main">Add my insurance details</span>
                        <span class="cta-hint">Secure form ¬∑ Takes ~2 min</span>
                      </button>
                    </div>
                  }

                  <!-- HOSPITAL NAVIGATION SECTION -->
                  @if (subResult.intent === 'hospital_navigation') {
                    <div class="hospital-navigation">
                      <p class="sub-message">{{ subResult.message }}</p>

                      @if (subResult.navigation) {
                        <div class="nav-card">
                          <!-- HEADER -->
                          <div class="nav-header">
                            <div>
                              <div class="nav-title">
                                {{ subResult.navigation.current_location?.name }}
                                @if (subResult.navigation.destination?.name) {
                                  ‚Üí {{ subResult.navigation.destination.name }}
                                } @else {
                                  <span class="no-destination">(Destination not found)</span>
                                }
                              </div>

                              @if (subResult.navigation.route) {
                                <div class="nav-meta">
                                  üìè {{ subResult.navigation.route?.distance }} ft ‚Ä¢ ‚è±Ô∏è
                                  {{ subResult.navigation.route?.estimated_time }} sec ‚Ä¢ ‚ôø
                                  {{
                                    subResult.navigation.route?.accessible ? 'Accessible' : 'Standard Route'
                                  }}
                                </div>
                              } @else {
                                <div class="nav-meta">
                                  <span class="suggested-locations">üìç Suggested locations available</span>
                                </div>
                              }
                            </div>

                            @if (subResult.navigation.route?.steps?.length) {
                              <button class="start-btn" (click)="startNavigationFromSubResult(subResult, $index)">‚ñ∂ Start</button>
                            }
                          </div>

                          <!-- TIMELINE -->
                          @if (subResult.navigation.route?.steps?.length) {
                            <div class="timeline">
                              @for (step of (subResult.navigation.route.steps ?? []); track $index) {
                                <div
                                  class="timeline-step"
                                  [class.active]="$index === (subResult.currentStepIndex ?? -1)"
                                  [class.completed]="$index < (subResult.currentStepIndex ?? -1)"
                                >
                                  <div class="timeline-icon">
                                    @switch (step.type) {
                                      @case ('walk') {
                                        üö∂
                                      }
                                      @case ('elevator') {
                                        üõó
                                      }
                                      @case ('arrival') {
                                        üìç
                                      }
                                      @case ('outdoor_walk') {
                                        üå§Ô∏è
                                      }
                                      @default {
                                        ‚û°Ô∏è
                                      }
                                    }
                                  </div>

                                  <div class="timeline-content">
                                    <div
                                      class="step-text"
                                      [class.active-text]="$index === (subResult.currentStepIndex ?? -1)"
                                    >
                                      {{ step.instruction }}
                                    </div>

                                    @if (step.distance) {
                                      <div class="step-distance">{{ step.distance }} ft</div>
                                    }
                                  </div>
                                </div>
                              }
                            </div>

                            <!-- PROGRESS BAR -->
                            <div class="progress-wrapper">
                              <div
                                class="progress-bar"
                                [style.width.%]="
                                  (((subResult.currentStepIndex ?? -1) + 1) /
                                    (subResult.navigation.route?.steps?.length ?? 1)) *
                                  100
                                "
                              ></div>
                            </div>
                          }
                        </div>
                      }
                    </div>
                  }
                </div>
              }

              @if (hasInsuranceOnlyAtTopLevel(msg.content)) {
                <div class="insurance-cta">
                  <button class="cta-insurance" (click)="goToInsurance(msg.content.insuranceLink)">
                    <span class="cta-main">Add my insurance details</span>
                    <span class="cta-hint">Secure form ¬∑ Takes ~2 min</span>
                  </button>
                </div>
              }
            </div>
          }

          <!-- INSURANCE VERIFICATION RESULT (success or failure) -->
          @else if (msg.content.type === 'insurance_verification_result') {
            <div class="insurance-verification-result" [class.success]="msg.content.insuranceVerificationSuccess" [class.failed]="!msg.content.insuranceVerificationSuccess">
              <p class="message-content">{{ msg.content.text }}</p>
              @if (msg.content.insuranceVerificationSuccess && msg.content.verificationResult?.verification_details; as details) {
                <div class="verification-details">
                  <h4>Coverage Details</h4>
                  <div class="detail-grid">
                    @if (details['coverage_type']) {
                      <div class="detail-item"><span>Plan Type</span><strong>{{ details['coverage_type'] }}</strong></div>
                    }
                    @if (details['copay_amount']) {
                      <div class="detail-item"><span>Copay</span><strong>${{ details['copay_amount'] }}</strong></div>
                    }
                    @if (details['effective_date']) {
                      <div class="detail-item"><span>Effective</span><strong>{{ details['effective_date'] }}</strong></div>
                    }
                    @if (details['expiration_date']) {
                      <div class="detail-item"><span>Expires</span><strong>{{ details['expiration_date'] }}</strong></div>
                    }
                  </div>
                </div>
              }
              @if (msg.content.nextSteps?.length) {
                <div class="next-steps">
                  <h4>‚ú® Next Steps</h4>
                  <ul>
                    @for (step of msg.content.nextSteps; track step) {
                      <li>{{ step }}</li>
                    }
                  </ul>
                </div>
              }
              @if (!msg.content.insuranceVerificationSuccess && msg.content.verificationResult?.errors; as errs) {
                @if (errs.length) {
                  <div class="verification-errors">
                    <h4>‚ö†Ô∏è What went wrong</h4>
                    <ul>
                      @for (err of errs; track err) {
                        <li>{{ err }}</li>
                      }
                    </ul>
                  </div>
                }
              }
              @if (!msg.content.insuranceVerificationSuccess && msg.content.requiresInsuranceValidation) {
                <div class="insurance-cta">
                  <button class="cta-insurance" (click)="goToInsurance(msg.content.insuranceLink)">
                    <span class="cta-main">Try again with correct details</span>
                    <span class="cta-hint">Update your insurance information ‚Üí</span>
                  </button>
                </div>
              }
            </div>
          }

          <!-- INSURANCE VALIDATION (needs more info) -->
          @else if (msg.content.type === 'insurance_validation') {
            <div class="insurance-validation-response">
              <p class="message-content">{{ msg.content.text }}</p>
              @if (msg.content.instructions?.length) {
                <ol class="insurance-instructions">
                  @for (instruction of msg.content.instructions; track instruction) {
                    <li>{{ instruction }}</li>
                  }
                </ol>
              }
              <div class="insurance-cta">
                <button class="cta-insurance" (click)="goToInsurance(msg.content.insuranceLink)">
                  <span class="cta-main">I'll add my insurance info</span>
                  <span class="cta-hint">Policy number, provider, and more ‚Üí</span>
                </button>
              </div>
            </div>
          }

          <!-- SINGLE INTENT: SYMPTOM ANALYSIS -->
          @else if (msg.content.type === 'symptom_analysis') {
            <div class="symptom-analysis">
              <p class="message-content">{{ msg.content.text }}</p>

              @if (msg.content.analysis) {
                <div class="analysis-card">
                  <div class="severity-badge" [attr.data-severity]="msg.content.analysis.severity">
                    {{ getSeverityLabel(msg.content.analysis.severity) }}
                  </div>

                  <div class="analysis-section">
                    <h4>üìã Analysis</h4>
                    <p>{{ msg.content.analysis.primary_analysis }}</p>

                    @if (msg.content.analysis.differential_diagnosis?.length) {
                      <div class="diagnosis-list">
                        <strong>Possible conditions:</strong>
                        <ul>
                          @for (
                            diagnosis of msg.content.analysis.differential_diagnosis;
                            track diagnosis
                          ) {
                            <li>{{ diagnosis }}</li>
                          }
                        </ul>
                      </div>
                    }
                  </div>

                  @if (msg.content.analysis.red_flags?.length) {
                    <div class="red-flags">
                      <h4>‚ö†Ô∏è Important Warnings</h4>
                      <ul>
                        @for (flag of msg.content.analysis.red_flags; track flag) {
                          <li>{{ flag }}</li>
                        }
                      </ul>
                    </div>
                  }
                </div>
              }

              @if (msg.content.recommendations) {
                <div class="recommendations">
                  @if (msg.content.recommendations.immediate_actions?.length) {
                    <div class="rec-section">
                      <h4>üéØ Immediate Actions</h4>
                      <ul>
                        @for (
                          action of msg.content.recommendations.immediate_actions;
                          track action
                        ) {
                          <li [innerHTML]="action"></li>
                        }
                      </ul>
                    </div>
                  }

                  @if (msg.content.recommendations.home_care_advice?.length) {
                    <div class="rec-section">
                      <h4>üè† Home Care</h4>
                      <ul>
                        @for (
                          advice of msg.content.recommendations.home_care_advice;
                          track advice
                        ) {
                          <li>{{ advice }}</li>
                        }
                      </ul>
                    </div>
                  }

                  @if (msg.content.recommendations.when_to_seek_help?.length) {
                    <div class="rec-section emergency">
                      <h4>üö® When to Seek Immediate Help</h4>
                      <ul>
                        @for (help of msg.content.recommendations.when_to_seek_help; track help) {
                          <li>{{ help }}</li>
                        }
                      </ul>
                    </div>
                  }

                  @if (msg.content.recommendations.preparation_for_doctor?.length) {
                    <div class="rec-section">
                      <h4>üìù Prepare for Doctor Visit</h4>
                      <ul>
                        @for (
                          prep of msg.content.recommendations.preparation_for_doctor;
                          track prep
                        ) {
                          <li>{{ prep }}</li>
                        }
                      </ul>
                    </div>
                  }
                </div>
              }

              @if (msg.content.careOptions?.matched_doctors) {
                <div class="matched-doctors">
                  <h4>üë®‚Äç‚öïÔ∏è Recommended Doctors</h4>
                  <div class="doctor-grid">
                    @for (
                      doctor of msg.content.careOptions?.matched_doctors?.slice(0, 3);
                      track doctor.id
                    ) {
                      <div class="doctor-card" (click)="selectDoctor(doctor)">
                        @if (doctor.imageUrl) {
                          <img [src]="doctor.imageUrl" [alt]="doctor.name" class="doctor-image" />
                        } @else {
                          <div class="doctor-avatar">{{ doctor.name.charAt(0) }}</div>
                        }
                        <div class="doctor-info">
                          <strong>{{ doctor.name }}</strong>
                          <span>{{ doctor.specialty }}</span>
                          @if (doctor.department) {
                            <span class="dept">{{ doctor.department }}</span>
                          }
                          @if (doctor.rating) {
                            <span class="rating">‚≠ê {{ doctor.rating.toFixed(1) }}</span>
                          }
                          @if (doctor.experience) {
                            <span class="experience">{{ doctor.experience }}</span>
                          }
                        </div>
                      </div>
                    }
                  </div>
                  @if ((msg.content.careOptions?.matched_doctors?.length ?? 0) > 3) {
                    <button class="view-all-btn" (click)="viewMatchedDoctors()">
                      View all {{ msg.content.careOptions?.matched_doctors?.length }} doctors
                    </button>
                  }
                </div>
              }

              @if (msg.content.nextSteps) {
                <div class="next-steps">
                  <h4>‚ú® Next Steps</h4>
                  <ul>
                    @for (step of msg.content.nextSteps; track step) {
                      <li>{{ step }}</li>
                    }
                  </ul>
                </div>
              }
            </div>
          }

          <!-- SINGLE INTENT: APPOINTMENT BOOKING -->
          @else if (msg.content.type === 'appointment_booking') {
            <div class="appointment-booking">
              <p class="message-content">{{ msg.content.text }}</p>

              @if (msg.content.instructions) {
                <div class="instructions">
                  @for (instruction of msg.content.instructions; track instruction) {
                    <div>{{ instruction }}</div>
                  }
                </div>
              }
            </div>
          } @else if (msg.content.type === 'doctor_list') {
            <div class="doctor-list-response">
              <div class="doctor-list-header">
                <span class="doctor-list-icon">üë®‚Äç‚öïÔ∏è</span>
                <h4 class="doctor-list-title">Here are the options of the doctors you asked for</h4>
                @if (msg.content.text) {
                  <p class="doctor-list-intro">{{ msg.content.text }}</p>
                }
              </div>
              @if (msg.content.careOptions?.matched_doctors?.length) {
                <div class="matched-doctors doctor-list-cards">
                  <div class="doctor-grid">
                    @for (
                      doctor of (msg.content.careOptions?.matched_doctors ?? []).slice(0, 6);
                      track doctor.id
                    ) {
                      <div class="doctor-card" (click)="selectDoctor(doctor)">
                        @if (doctor.imageUrl) {
                          <img
                            [src]="doctor.imageUrl"
                            [alt]="doctor.name"
                            class="doctor-image"
                          />
                        } @else {
                          <div class="doctor-avatar">{{ doctor.name.charAt(0) }}</div>
                        }
                        <div class="doctor-info">
                          <strong>{{ doctor.name }}</strong>
                          <span>{{ doctor.specialty }}</span>
                          @if (doctor.department) {
                            <span class="dept">{{ doctor.department }}</span>
                          }
                          @if (doctor.rating != null) {
                            <span class="rating">‚≠ê {{ doctor.rating.toFixed(1) }}</span>
                          }
                          @if (doctor.experience) {
                            <span class="experience">{{ doctor.experience }}</span>
                          }
                        </div>
                      </div>
                    }
                  </div>
                  @if ((msg.content.careOptions?.matched_doctors?.length ?? 0) > 6) {
                    <button class="view-all-btn" (click)="viewMatchedDoctors()">
                      View all {{ msg.content.careOptions?.matched_doctors?.length ?? 0 }} doctors
                    </button>
                  } @else {
                    <button class="cta-doctors" (click)="viewMatchedDoctors()">
                      View details & book appointment
                    </button>
                  }
                </div>
              }
            </div>
          } @else if (msg.content.type === 'hospital_navigation') {
            <div class="hospital-navigation">
              <p class="message-content">{{ msg.content.text }}</p>

              @if (msg.content.navigation) {
                <div class="nav-card">
                  <!-- HEADER -->
                  <div class="nav-header">
                    <div>
                      <div class="nav-title">
                        {{ msg.content.navigation.current_location?.name }}
                        ‚Üí
                        {{ msg.content.navigation.destination?.name }}
                      </div>

                      <div class="nav-meta">
                        üìè {{ msg.content.navigation.route?.distance }} ft ‚Ä¢ ‚è±Ô∏è
                        {{ msg.content.navigation.route?.estimated_time }} sec ‚Ä¢ ‚ôø
                        {{
                          msg.content.navigation.route?.accessible ? 'Accessible' : 'Standard Route'
                        }}
                      </div>
                    </div>

                    <button class="start-btn" (click)="startNavigation(msg)">‚ñ∂ Start</button>
                  </div>

                  <!-- TIMELINE -->
                  <div class="timeline">
                    @for (step of (msg.content.navigation.route?.steps ?? []); track $index) {
                      <div
                        class="timeline-step"
                        [class.active]="$index === msg.content.currentStepIndex"
                        [class.completed]="$index < (msg?.content?.currentStepIndex ?? -1)"
                      >
                        <div class="timeline-icon">
                          @switch (step.type) {
                            @case ('walk') {
                              üö∂
                            }
                            @case ('elevator') {
                              üõó
                            }
                            @case ('arrival') {
                              üìç
                            }
                            @case ('outdoor_walk') {
                              üå§Ô∏è
                            }
                            @default {
                              ‚û°Ô∏è
                            }
                          }
                        </div>

                        <div class="timeline-content">
                          <div
                            class="step-text"
                            [class.active-text]="$index === msg.content.currentStepIndex"
                          >
                            {{ step.instruction }}
                          </div>

                          @if (step.distance) {
                            <div class="step-distance">{{ step.distance }} ft</div>
                          }
                        </div>
                      </div>
                    }
                  </div>

                  <!-- PROGRESS BAR -->
                  <div class="progress-wrapper">
                    <div
                      class="progress-bar"
                      [style.width.%]="
                        (((msg.content.currentStepIndex ?? -1) + 1) /
                          (msg.content.navigation.route?.steps?.length ?? 1)) *
                        100
                      "
                    ></div>
                  </div>
                </div>
              }
            </div>
          }

          <!-- DEFAULT: TEXT RESPONSE -->
          @else {
            <div class="text-response">
              <p class="message-content">{{ msg.content.text }}</p>
              @if (msg.content.requiresInsuranceValidation || msg.content.insuranceLink) {
                <div class="insurance-cta">
                  <button class="cta-insurance" (click)="goToInsurance(msg.content.insuranceLink)">
                    <span class="cta-main">Add my insurance details</span>
                    <span class="cta-hint">We'll verify your coverage</span>
                  </button>
                </div>
              }
            </div>
          }
        }
      </div>
    } @empty {
      @if (!isTyping()) {
        <div class="placeholder-state">
          <div class="placeholder-icon">üí¨</div>
          <p class="placeholder-title">How can I help you today?</p>
          <p class="placeholder-subtitle">
            Describe your symptoms, book appointments, or get hospital guidance.
          </p>

          <div class="quick-actions">
            <button (click)="inputValue.set('I have a fever and headache')">
              ü§í Report Symptoms
            </button>
            <button (click)="inputValue.set('I need to book an appointment')">
              üìÖ Book Appointment
            </button>
            <button (click)="goToInsurance()">
              üõ°Ô∏è Add insurance info
            </button>
            <button (click)="inputValue.set('Where is the cafeteria?')">
              üó∫Ô∏è Hospital Navigation
            </button>
          </div>
        </div>
      }
    }

    <!-- Automation confirmation bubble (only when Automation Mode is OFF) -->
    @if (automation.pendingNavigation(); as navReq) {
      <div class="message assistant animate-msg automation-confirm">
        <span class="message-label">{{ assistantName }}</span>
        <div class="automation-card">
          <p class="automation-title">
            I can continue this journey for you.
          </p>
          <p class="automation-body">
            I detected that you might want to go to
            <strong>{{ getNavTargetLabel(navReq.target) }}</strong>. Should I take you there now?
          </p>
          <div class="automation-actions">
            <button type="button" class="btn-primary" (click)="automation.confirmNavigation()">
              Yes, continue
            </button>
            <button type="button" class="btn-secondary" (click)="automation.cancelNavigation()">
              No, stay here
            </button>
          </div>
        </div>
      </div>
    }

    @if (isTyping()) {
      <div class="message assistant typing animate-msg">
        <span class="message-label">{{ assistantName }}</span>
        <div class="typing-dots"><span></span><span></span><span></span></div>
      </div>
    }
  </div>

  <div class="input-row">
    <input
      type="text"
      placeholder="e.g. I'm having a fever and headache..."
      [value]="inputValue()"
      (input)="onInput($event)"
      (keydown.enter)="send()"
    />
    <button
      type="button"
      class="send-btn"
      (click)="send()"
      [disabled]="!inputValue().trim() || isTyping()"
    >
      <svg
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" />
      </svg>
      Send
    </button>
  </div>
</section>
