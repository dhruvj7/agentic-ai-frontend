<div class="app-layout">
  <app-navbar />
  <main class="main">
    <router-outlet />
  </main>
  <app-footer />
</div>

<!-- Step Transition Modal for Multi-Step Navigation -->
@if (automation.pendingStepTransition(); as pending) {
  <div class="step-transition-overlay" (click)="automation.stayOnCurrentStep()">
    <div class="step-transition-modal" (click)="$event.stopPropagation()">
      <div class="step-transition-header">
        @if (pending.step.intent === 'appointment_booking' || pending.step.target === 'book-appointment' || pending.step.target === 'booking') {
          <span class="step-transition-icon">ğŸ“…</span>
          <h3>Booking Your Appointment</h3>
          <p class="step-transition-desc">
            I'm booking an appointment for you with the first available doctor.
          </p>
        } @else {
          <span class="step-transition-icon">{{ pending.isInitial ? 'âœ¨' : 'ğŸš€' }}</span>
          <h3>{{ pending.isInitial ? 'Begin Your Journey' : 'Ready for Next Step?' }}</h3>
          <p class="step-transition-desc">
            {{ pending.isInitial ? 'Your first step:' : "You've completed the current step. Here's what's next:" }}
          </p>
        }
      </div>
      
      <div class="step-transition-content">
        <div class="next-step-info">
          <div class="step-badge">
            @let currentIdx = automation.currentStepIndex();
            <span class="step-number">{{ pending.isInitial ? 1 : currentIdx + 2 }}</span>
            <span class="step-label">{{ getStepLabel(pending.step.intent) }}</span>
          </div>
          <p class="step-message">{{ pending.step.message }}</p>
          
          @if (pending.step.data?.destination) {
            <p class="step-detail">ğŸ“ Destination: {{ pending.step.data.destination }}</p>
          }
          
          @if ((pending.step.intent === 'appointment_booking' || pending.step.target === 'book-appointment' || pending.step.target === 'booking') && pending.step.data?.doctor && pending.step.data?.slot) {
            <div class="booking-details">
              <p class="step-detail">
                <strong>ğŸ‘¨â€âš•ï¸ Doctor:</strong> {{ pending.step.data.doctor.name }}
              </p>
              <p class="step-detail">
                <strong>ğŸ“… Date & Time:</strong> {{ formatSlotLabel(pending.step.data.slot) }}
              </p>
              <p class="step-detail">
                <strong>ğŸ¥ Specialty:</strong> {{ pending.step.data.doctor.specialty }}
              </p>
            </div>
          }
        </div>
      </div>

      <div class="step-transition-actions">
        <button
          type="button"
          class="btn-stay-step"
          (click)="automation.stayOnCurrentStep()"
        >
          Stay Here
        </button>
        <button
          type="button"
          class="btn-proceed-step"
          (click)="automation.confirmStepAndNavigate()"
        >
          @if (pending.step.intent === 'appointment_booking' || pending.step.target === 'book-appointment' || pending.step.target === 'booking') {
            Continue to Booking
          } @else {
            {{ pending.isInitial ? 'Start Journey' : 'Continue to Next Step' }}
          }
        </button>
      </div>
    </div>
  </div>
}
